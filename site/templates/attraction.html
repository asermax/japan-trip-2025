{% extends "basic.html" %}

{% block title %}{{ page.title }} | {{ config.title }}{% endblock title %}

{% block extra_head %}
{% if page.extra.latitude and page.extra.longitude %}
<!-- Map Styles -->
<link rel="stylesheet" href="/css/maps.css">
<!-- Custom Maps JavaScript - Load before Google Maps API -->
<script src="/js/maps.js"></script>
<!-- Google Maps API -->
<script src="https://maps.googleapis.com/maps/api/js?key={{ config.extra.google_maps_api_key }}&callback=initMap&libraries=&v=weekly" async defer></script>
<script>
window.initMap = function() {
  const location = { lat: {{ page.extra.latitude }}, lng: {{ page.extra.longitude }} };
  const map = new google.maps.Map(document.getElementById('attraction-map'), {
    zoom: 15,
    center: location,
    mapTypeControl: true,
    streetViewControl: true,
    fullscreenControl: true
  });

  const marker = new google.maps.Marker({
    position: location,
    map: map,
    title: "{{ page.title | escape }}"
  });

  const infoWindow = new google.maps.InfoWindow({
    content: '<div style="padding: 8px;"><strong>{{ page.title | escape }}</strong></div>'
  });

  marker.addListener('click', () => {
    infoWindow.open(map, marker);
  });
}
</script>
{% endif %}

<script>
// Override back button to go to timeline entry page
document.addEventListener('DOMContentLoaded', function() {
  const backBtn = document.querySelector('.back_btn a');
  if (backBtn && "{{ page.extra.timeline_entries.0 }}") {
    backBtn.onclick = function(e) {
      e.preventDefault();
      window.location.href = '/{{ page.extra.timeline_entries.0 }}/';
    };
  }
});
</script>
{% endblock extra_head %}

{% block content %}
<article class="post animated fadeInDown">
  <div class="post-title">
    <h1>{{ page.title }}</h1>
    {% if page.description %}
    <div class="description">{{ page.description }}</div>
    {% endif %}
  </div>

  <div class="post-content">
    {% if page.extra.location or page.extra.category or page.extra.cost or page.extra.best_time %}
    <div class="meta">
      {% if page.extra.location %}
      <div><strong>üìç Location:</strong> {{ page.extra.location }}</div>
      {% endif %}

      {% if page.extra.category %}
      <div><strong>üè∑Ô∏è Category:</strong> {{ page.extra.category }}</div>
      {% endif %}

      {% if page.extra.cost %}
      <div><strong>üí∞ Cost:</strong> {{ page.extra.cost }}</div>
      {% endif %}

      {% if page.extra.best_time %}
      <div><strong>‚è∞ Best Time:</strong> {{ page.extra.best_time }}</div>
      {% endif %}

      {% if page.extra.duration %}
      <div><strong>‚è±Ô∏è Duration:</strong> {{ page.extra.duration }}</div>
      {% endif %}

      {% if page.extra.difficulty %}
      <div><strong>üö∂ Difficulty:</strong> {{ page.extra.difficulty }}</div>
      {% endif %}
    </div>
    {% endif %}

    {{ page.content | safe }}

    {% if page.extra.latitude and page.extra.longitude %}
    <div class="map-section">
      <h2>üìç Location Map</h2>
      <div id="attraction-map" class="map-container"></div>
    </div>
    {% endif %}
  </div>

  <div class="post-footer">
    {% if page.taxonomies.tags %}
    <div class="tags">
      <ul>
        {% for tag in page.taxonomies.tags %}
        <li><a href="/tags/{{ tag | slugify }}/">#{{ tag }}</a></li>
        {% endfor %}
      </ul>
    </div>
    {% endif %}

    {% if page.taxonomies.categories %}
    <div class="tags">
      <ul>
        {% for category in page.taxonomies.categories %}
        <li><a href="/categories/{{ category | slugify }}/">{{ category }}</a></li>
        {% endfor %}
      </ul>
    </div>
    {% endif %}
  </div>

  {% if page.extra.previous_attraction or page.extra.next_attraction %}
  <div class="pagination">
    <ul>
      {% if page.extra.previous_attraction %}
      <li class="pre">
        <a href="/attractions/{{ page.extra.previous_attraction }}/">
          ‚Üê {% if page.extra.previous_title %}{{ page.extra.previous_title }}{% else %}Previous{% endif %}
        </a>
      </li>
      {% endif %}

      {% if page.extra.next_attraction %}
      <li class="next">
        <a href="/attractions/{{ page.extra.next_attraction }}/">
          {% if page.extra.next_title %}{{ page.extra.next_title }}{% else %}Next{% endif %} ‚Üí
        </a>
      </li>
      {% endif %}
    </ul>
  </div>
  {% endif %}
</article>
{% endblock content %}